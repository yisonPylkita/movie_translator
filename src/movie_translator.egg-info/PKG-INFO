Metadata-Version: 2.4
Name: movie-translator
Version: 0.1.0
Summary: Add your description here
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pysubs2>=1.8.0
Requires-Dist: tqdm>=4.67.1
Requires-Dist: transformers>=4.30.0
Requires-Dist: torch>=2.0.0
Requires-Dist: sentencepiece>=0.1.99
Requires-Dist: sacremoses>=0.1.1
Requires-Dist: protobuf>=3.20.0
Requires-Dist: ruff>=0.6.0
Dynamic: license-file

# Movie Translator

Automatically translate MKV subtitle files from English to Polish using AI-powered context-aware translation.

## Features

- **Sophisticated Translation**: Uses the `llm-subtrans` library for context-aware subtitle translation
- **Scene Detection**: Automatically batches subtitles into scenes for better translation context
- **Robust Error Handling**: Comprehensive error handling with detailed logging
- **In-place Processing**: Embeds translated subtitles directly into MKV files
- **Batch Processing**: Processes all MKV files in a directory automatically

## Requirements

- Python 3.10+
- `uv` (Python package manager)
- MKVToolNix (`mkvmerge` and `mkvextract` must be in PATH)
- OpenAI API key

## Installation

```bash
# Clone the repository
git clone <repository-url>
cd movie_translator

# Sync dependencies with uv
uv sync
```

## Usage

### Basic Usage

```bash
# Set your OpenAI API key
export OPENAI_API_KEY="your-api-key-here"

# Run the translator on a directory of MKV files
uv run movie-translator /path/to/movies
```

### Advanced Usage

```bash
# Specify the API key directly
uv run movie-translator /path/to/movies --api-key your-key

# Use a different OpenAI model
uv run movie-translator /path/to/movies --model gpt-4o

# Translate to a different language
uv run movie-translator /path/to/movies --target-language French
```

### Configuration Options

| Option | Description | Default |
|--------|-------------|---------|
| `--api-key` | OpenAI API key (or use `OPENAI_API_KEY` env var) | - |
| `--model` | OpenAI model to use | `gpt-4o-mini` |
| `--target-language` | Target language for translation | `Polish` |

### Programmatic Usage

You can also use the package programmatically:

```python
from movie_translator import translate_file, TranslationConfig

config = TranslationConfig(
    api_key="your-api-key",
    target_language="Polish",
    model="gpt-4o-mini"
)

translate_file(
    input_path="movie_en.srt",
    output_path="movie_pl.srt",
    api_key=config.api_key,
    movie_name="The Matrix"
)
```

## How It Works

1. **Scans directory** for MKV files
2. **Identifies English subtitle tracks** using mkvmerge
3. **Extracts subtitles** to SRT format using mkvextract
4. **Translates** using AI with scene context and batch processing
5. **Embeds translated subtitles** back into MKV file
6. **Replaces original file** with the updated version

## Troubleshooting

### "mkvmerge: command not found"

Install MKVToolNix:
- **macOS**: `brew install mkvtoolnix`
- **Ubuntu/Debian**: `sudo apt-get install mkvtoolnix`
- **Windows**: Download from [MKVToolNix website](https://mkvtoolnix.download/)

### "No API key provided"

Either:
- Set the environment variable: `export OPENAI_API_KEY="your-key"`
- Pass it as an argument: `--api-key your-key`

### Translation fails with rate limit errors

The `llm-subtrans` library includes automatic retry logic with exponential backoff. If you're still hitting rate limits, consider:
- Using a higher tier API key
- Reducing the batch size (requires code modification)
- Adding delays between files (manual)

## Project Structure

```
movie_translator/
├── src/movie_translator/
│   ├── __init__.py          # Package exports
│   ├── config.py            # Configuration management
│   ├── constants.py         # Shared constants
│   ├── exceptions.py        # Custom exceptions
│   ├── main.py              # CLI and batch processor
│   └── translator_adapter.py # Translation logic adapter
├── pyproject.toml           # Project configuration
└── README.md                # This file
```

## License

MIT License
